---
id: 124
title: Finding and Utilising an Exploit against Windows XP using Metasploit
date: 2017-12-11T21:27:19+00:00
author: shortmsgserv
layout: post
guid: http://shortmsgserv.co.uk/?p=124
permalink: /finding-and-utilising-an-exploit-against-windows-xp-using-metasploit/
image: /wp-content/uploads/2017/12/Metasploit-XP.png
categories:
  - Exploits
  - Metasploit
tags:
  - Exploit
  - Kali
  - Longhorn
  - Metasploit
  - MS08-067
  - Nessus
  - Nmap
  - Offensive Security
  - Tools
  - VirtualBox
  - Vulnerability
  - Windows Vista
  - Windows XP
---
<img class="aligncenter size-full wp-image-139" src="https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Metasploit-XP.png?resize=640%2C400" alt="Metasploit XP" width="640" height="400" srcset="https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Metasploit-XP.png?w=800 800w, https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Metasploit-XP.png?resize=300%2C188 300w, https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Metasploit-XP.png?resize=768%2C480 768w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" />

Windows XP represents a key moment in software security. XP was released just as the internet started becoming prevalent in homes as well as offices, because of this prevalence it became clear that security was not a priority during software development. After the release of XP the number of viruses and known vulnerabilities skyrocketed. In response to Windows XP’s poor security becoming apparent, Microsoft shifted manpower from Longhorn; its next release of Windows, to implementing security features planned for Longhorn into Windows XP Service Pack 2, leaving over five years between the release of Windows XP and Longhorn; the operating system that would come to be known as Windows Vista.

For organisations and home users Windows XP’s poor security is a nightmare, but as I’m looking to build-up my skills at testing exploits and examining the security of software it is a dream. Windows XP now has so many known exploits that I’m almost spoilt for choice. So because of this I got myself a copy of XP and decided to try and take advantage of an exploit.

At first I thought this would be so easy that it would take no more than five minutes, this was not the case however, as instead of the very first version of Windows XP, I had a copy of Service Pack 3 which remedied a good amount of the earlier issues. This added complexity meant that instead of leveraging an obvious exploit pulled from a quick Google search, I would have to do a bit more digging with my version of XP to find what vulnerabilities applied to it.

This also means that instead of briefly making a blog post stating that I had completed my first exploit, I thought it might be useful if I outlined my working in more detail and create a full length tutorial so that it may help others if they get struck.

# Getting Setup

My first exploit required a couple of tools. The first is <a href="https://www.virtualbox.org" target="_blank" rel="noopener">VirtualBox</a> which is a free virtualisation product you can use to run other operating systems within your main operating system. Within VirtualBox you’ll need to create your Windows XP Virtual Machine by clicking on “New” in the menu bar:

<img class="aligncenter wp-image-133 size-large" src="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Windows_XP_Virtualbox_Create.png?resize=640%2C496" alt="Creating a Windows XP VirtualBox" width="640" height="496" srcset="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Windows_XP_Virtualbox_Create.png?resize=1024%2C794 1024w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Windows_XP_Virtualbox_Create.png?resize=300%2C233 300w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Windows_XP_Virtualbox_Create.png?resize=768%2C596 768w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Windows_XP_Virtualbox_Create.png?w=1280 1280w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

The name can actually be anything, but typing Windows XP will automatically set the “Type” and “Version” to Windows XP 32-bit. Follow the steps to on the next few pages to create your machine (I’d recommend giving it around 2GB of RAM is you have enough, but the default recommendation of a 10 GB Hard Drive should probably be enough) and when it asks choose your image of Windows XP and once the machine boots it will be like installing Windows XP on any computer. A final step within Windows XP itself after creating your user is to disable Windows firewall within _Start>Control Panel_.

You’ll need to create a second virtual machine for <a href="https://www.kali.org" target="_blank" rel="noopener">Kali Linux</a>. The download at kali.org will work within VirtualBox, but after speaking to a friend and finding they were able to change the resolution of their VM and I was stuck with a tiny 1024&#215;768; they informed me that the download available at <a href="https://www.offensive-security.com/kali-linux-vmware-virtualbox-image-download/" target="_blank" rel="noopener">Offensive Security</a> would work better as this is a preconfigured VirtualBox image. This image is a lot easier to setup. Once the image has downloaded click File > Import Appliance, and it will configure itself. Be sure to also update your Kali install by going to terminal and typing

_$ sudo apt-get update && sudo apt-get upgrade_

For both the Kali and XP virtual machines you’ll also need to change the network settings so that they use “Bridged Adapter” instead of “NAT,” otherwise your two virtual machines might not be able to communicate.

<img class="size-large wp-image-125 aligncenter" src="https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Bridged_Virtual_Machine.png?resize=640%2C496" alt="Windows XP Exploit Network Settings" width="640" height="496" srcset="https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Bridged_Virtual_Machine.png?resize=1024%2C793 1024w, https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Bridged_Virtual_Machine.png?resize=300%2C232 300w, https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Bridged_Virtual_Machine.png?resize=768%2C595 768w, https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Bridged_Virtual_Machine.png?w=1526 1526w, https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Bridged_Virtual_Machine.png?w=1280 1280w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

Both virtual machine images are needed to carry out the exploit, but the tool needed to help actually find the vulnerabilities we can use is <a href="https://www.tenable.com/products/nessus-vulnerability-scanner" target="_blank" rel="noopener">Nessus</a>.

Nessus is a vulnerability scanner that will indicate what exploits a system may be vulnerable to. Nessus does have a paid for version, but we’ll stick with the personal use version. When you visit the <a href="https://www.tenable.com/products/nessus/select-your-operating-system" target="_blank" rel="noopener">download page</a> you will also need to request an activation code that will be sent to your email.

Once the file for Nessus has downloaded the next step will be to enter a terminal window and unpack it with

_$ dpkg -i <file path and name>_

<img class="size-large wp-image-128 aligncenter" src="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Install_of_Nessus_Kali.png?resize=640%2C434" alt="Installing Nessus in Terminal in Kali" width="640" height="434" srcset="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Install_of_Nessus_Kali.png?resize=1024%2C695 1024w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Install_of_Nessus_Kali.png?resize=300%2C204 300w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Install_of_Nessus_Kali.png?resize=768%2C522 768w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Install_of_Nessus_Kali.png?w=1340 1340w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Install_of_Nessus_Kali.png?w=1280 1280w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

Start the Nessus process with

_$ /etc/init.d/nessusd start_

Then enter https://kali:8834 into Firefox within Kali, create your Nessus login credentials and enter your activation code, it may also need a healthy amount of time to update. Once this is complete and your at the main Nessus homepage, feel free to minimise the window and return to it later.

# Scanning for Vulnerabilities

With the tools setup and started you’ll be able to get started with finding vulnerabilities to test. For starters it is always good to start a scan with Nmap to get an overview of what services are running on the system with the terminal command

_$ sudo nmap 192.168.0.28_

<img class="size-large wp-image-130 aligncenter" src="https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/XP_Scan_Nmap.png?resize=640%2C426" alt="Scanning XP with Nmap" width="640" height="426" srcset="https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/XP_Scan_Nmap.png?resize=1024%2C682 1024w, https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/XP_Scan_Nmap.png?resize=300%2C200 300w, https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/XP_Scan_Nmap.png?resize=768%2C511 768w, https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/XP_Scan_Nmap.png?w=1463 1463w, https://i0.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/XP_Scan_Nmap.png?w=1280 1280w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

This will show the services that are active on the Windows XP installation. Other scans such as an operating system scan could be run at this point to determine the operating system currently being run so that the range of exploits could be narrowed down. I already know the version being run so won’t run an OS scan as it will likely not give me any further information than I already know.

We have a basic overview of what services are running on the XP machine, but the aim is to utilise an exploit. This is where Nessus comes in. Bring your Nessus window back to the fore (or if you closed it load it with _https://kali__:__8834_). After logging into Nessus you’ll be presented with an empty “My Scans” page.

<img class="size-large wp-image-131 aligncenter" src="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_My_Scans.png?resize=640%2C521" alt="Nessus My Scans Page" width="640" height="521" srcset="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_My_Scans.png?resize=1024%2C834 1024w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_My_Scans.png?resize=300%2C244 300w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_My_Scans.png?resize=768%2C626 768w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_My_Scans.png?w=1280 1280w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_My_Scans.png?w=1920 1920w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

Once you’ve clicked on “New Scan” you’ll be presented with a number of options, some of which require an upgrade to Nessus Professional. The scan we need is a “Basic Network Scan”.

<img class="aligncenter wp-image-132 size-thumbnail" src="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Basic_Scan.png?resize=150%2C150" alt="Nessus Basic Network Scan Button" width="150" height="150" srcset="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Basic_Scan.png?resize=150%2C150 150w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Basic_Scan.png?zoom=2&resize=150%2C150 300w" sizes="(max-width: 150px) 100vw, 150px" data-recalc-dims="1" /> 

Enter a name for the scan that means something to you. Choose the target you’d like to scan. In this case we want the XP machine’s IP address. Instead of just clicking “Save” click the adjacent disclosure triangle and choose “Launch” to get the scan started straight away. The scan can take some time to complete so be patient and let it run.

# Using a Vulnerability

When the Nessus scan completes, click on the vulnerability tab to be show a list of items ranging from critical vulnerabilities to basic information that the operating system may be broadcasting publicly. Your results may well match mine if we have the same version of Windows XP, the vulnerability I will utilise is the one at the top; <a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2008/ms08-067" target="_blank" rel="noopener">MS08-067</a>.

<img class="size-large wp-image-134 aligncenter" src="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Scan_Complete.png?resize=640%2C419" alt="Nessus Scan Complete" width="640" height="419" srcset="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Scan_Complete.png?resize=1024%2C670 1024w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Scan_Complete.png?resize=300%2C196 300w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Scan_Complete.png?resize=768%2C502 768w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Scan_Complete.png?w=1280 1280w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Nessus_Scan_Complete.png?w=1920 1920w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

Utilising the exploit needs the use of another tool, Metasploit, that is already part of our Kali Linux image. Load up Metasploit by moving to a terminal window and typing

_ $msfconsole_

If this is your first time starting Metasploit you’ll need to create a database. Rather than digress here the team at Offensive Security have a clear explanation <a href="https://www.offensive-security.com/metasploit-unleashed/using-databases/" target="_blank" rel="noopener">here</a> (for this tutorial you’ll only need the “Setup our Metasploit Database” section).

With the Metasploit console loaded we’ll need to find the exploit we’re looking to use within the Metasploit database by entering

_> search MS08-067_

This should present one result of exploit/windows/smb/ms08\_067\_netapi which we will need to utilise by entering

_> use exploit/windows/smb/ms08\_067\_netapi_

<img class="aligncenter wp-image-135 " src="https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_in_focus_metasploit.png?resize=545%2C35" alt="Exploit in Focus" width="545" height="35" srcset="https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_in_focus_metasploit.png?w=810 810w, https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_in_focus_metasploit.png?resize=300%2C19 300w, https://i2.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_in_focus_metasploit.png?resize=768%2C49 768w" sizes="(max-width: 545px) 100vw, 545px" data-recalc-dims="1" /> 

Metasploit should now show our desired exploit in its initial stream. The exploit will likely have variables though and we need to know what they are, otherwise the exploit may fail. We can find them out by entering the command

_> show options _

<img class="aligncenter size-large wp-image-136" src="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/ms08_067_options_metasploit.png?resize=640%2C318" alt="MS08_067 Options in Metasploit" width="640" height="318" srcset="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/ms08_067_options_metasploit.png?resize=1024%2C509 1024w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/ms08_067_options_metasploit.png?resize=300%2C149 300w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/ms08_067_options_metasploit.png?resize=768%2C382 768w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/ms08_067_options_metasploit.png?w=1316 1316w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

MS08_067s options should present themselves as above and we can see that two of the options (RPORT and SMBPIPE) are already populated. RHOST is not and is flagged as “Required: Yes” so we will need it. Luckily RHOST is a simple one to find in this case as it stands for Remote Host which is our XP virtual machine. To set our XP machines address as the RHOST type

_> set RHOST <VM IP Address>_

The next step will prove that all your hard work will have paid off, the execution of the exploit. To take the juiciest step all you need to type is

_> exploit_

<img class="aligncenter size-large wp-image-137" src="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_Success_Metasploit.png?resize=640%2C246" alt="Exploit Success in Metasploit" width="640" height="246" srcset="https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_Success_Metasploit.png?resize=1024%2C393 1024w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_Success_Metasploit.png?resize=300%2C115 300w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_Success_Metasploit.png?resize=768%2C295 768w, https://i1.wp.com/shortmsgserv.co.uk/wp-content/uploads/2017/12/Exploit_Success_Metasploit.png?w=1314 1314w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /> 

Once a few seconds have passed the terminal window should show meterpreter which will allow you to run various commands on your target. If you’d like to know what you can run simply enter the command

_> help_

which will list any available commands you can run. To verify you have successfully completed the exploit I would recommend running _ipconfig_ to show the IP address of the machine as well as _screenshot_ to be able to visibly see the machine running. If you would like to feel you hold real power, feel free to enter _shutdown_ which, unsurprisingly, will shut down the virtual machine.

# Personal Lessons

This exercise has allowed my knowledge to grow far greater than I had expected. Due to Windows XP’s reputation for poor security I had half-expected to follow a <a href="https://null-byte.wonderhowto.com/how-to/hack-like-pro-exploit-and-gain-remote-access-pcs-running-windows-xp-0134709/" target="_blank" rel="noopener">tutorial</a> and have successfully carried out an exploit within about half-an-hour.

Struggling to follow this due to me using Service Pack 3 has taught me far more valuable skills than with the tutorial alone as I would have solely learnt how to execute one exploit with Metasploit, on one operating system.

Being unable to follow a structured tutorial has meant that not only have I learnt how to utilise Nessus; not only for Windows XP  but also other operating systems, but I have had to investigate how I would find exploits within an operating system which led me to Nessus. These skills are transferrable to more than just one exploit on one operating system which is infinitely more useful. Thoughout my career I have found that lessons I have learnt on one issue can be adapted for other problems I may face in the future and it is always important to not get put off at the first issue.